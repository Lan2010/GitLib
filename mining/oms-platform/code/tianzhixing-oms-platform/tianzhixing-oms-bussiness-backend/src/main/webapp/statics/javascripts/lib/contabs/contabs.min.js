var handleTab, aTab;
$(function () {
    function a(a) {
        var e = 0;
        return $(a).each(function () {
            e += $(this).outerWidth(!0)
        }), e
    }

    function e(e) {
        var t = a($(e).prevAll()),
            n = a($(e).nextAll()),
            i = a($(".content-tabs").children().not(".J_menuTabs")),
            r = $(".content-tabs").outerWidth(!0) - i,
            s = 0;
        if ($(".page-tabs-content").outerWidth() < r) s = 0;
        else if (n <= r - $(e).outerWidth(!0) - $(e).next().outerWidth(!0)) {
            if (r - $(e).next().outerWidth(!0) > n) {
                s = t;
                for (var d = e; s - $(d).outerWidth() > $(".page-tabs-content").outerWidth() - r;) s -= $(d).prev().outerWidth(), d = $(d).prev()
            }
        } else t > r - $(e).outerWidth(!0) - $(e).prev().outerWidth(!0) && (s = t - $(e).prev().outerWidth(!0));
        $(".page-tabs-content").animate({
            marginLeft: 0 - s + "px"
        }, "fast")
    }

    function t() {
        var e = Math.abs(parseInt($(".page-tabs-content").css("margin-left"))),
            t = a($(".content-tabs").children().not(".J_menuTabs")),
            n = $(".content-tabs").outerWidth(!0) - t,
            i = 0;
        if ($(".page-tabs-content").width() < n) return !1;
        for (var r = $(".J_menuTab:first"), s = 0; s + $(r).outerWidth(!0) <= e;) s += $(r).outerWidth(!0), r = $(r).next();
        if (s = 0, a($(r).prevAll()) > n) {
            for (; s + $(r).outerWidth(!0) < n && r.length > 0;) s += $(r).outerWidth(!0), r = $(r).prev();
            i = a($(r).prevAll())
        }
        $(".page-tabs-content").animate({
            marginLeft: 0 - i + "px"
        }, "fast")
    }

    function n() {
        var e = Math.abs(parseInt($(".page-tabs-content").css("margin-left"))),
            t = a($(".content-tabs").children().not(".J_menuTabs")),
            n = $(".content-tabs").outerWidth(!0) - t,
            i = 0;
        if ($(".page-tabs-content").width() < n) return !1;
        for (var r = $(".J_menuTab:first"), s = 0; s + $(r).outerWidth(!0) <= e;) s += $(r).outerWidth(!0), r = $(r).next();
        for (s = 0; s + $(r).outerWidth(!0) < n && r.length > 0;) s += $(r).outerWidth(!0), r = $(r).next();
        i = a($(r).prevAll()), i > 0 && $(".page-tabs-content").animate({
            marginLeft: 0 - i + "px"
        }, "fast")
    }
    handleTab = function a() {
        var t = $(this).attr("href"),
            n = $(this).data("index"),
            i = $.trim($(this).text()),
            a = !0;
        if (void 0 == t || 0 == $.trim(t).length) return !1;
        if ($(".J_menuTab").each(function () {
                return $(this).data("id") == t ? ($(this).hasClass("active") || ($(this).addClass("active").siblings(".J_menuTab").removeClass("active"), e(this), $(".J_mainContent .J_iframe").each(function () {
                    return $(this).data("id") == t ? ($(this).show().siblings(".J_iframe").hide(), !1) : void 0
                })), a = !1, !1) : void 0
            }), a) {
            var r = '<a href="javascript:;" class="active J_menuTab" data-id="' + t + '">' + i + ' <i class="fa fa-times-circle"></i></a>';
            $(".J_menuTab").removeClass("active");
            var s = '<iframe class="J_iframe" name="iframe' + n + '" width="100%" height="100%" src="' + t + '" frameborder="0" data-id="' + t + '" seamless></iframe>';
            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(s);
            var d = layer.load();
            $(".J_mainContent iframe:visible").load(function () {
                layer.close(d)
            }), $(".J_menuTabs .page-tabs-content").append(r), e($(".J_menuTab.active"))
        }
        if (!a) {
            $(".J_mainContent iframe:visible").remove();
            var s = '<iframe class="J_iframe" name="iframe' + n + '" width="100%" height="100%" src="' + t + '" frameborder="0" data-id="' + t + '" seamless></iframe>';
            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(s);
            var d = layer.load();
            $(".J_mainContent iframe:visible").load(function () {
                layer.close(d)
            }), $(".J_menuTabs .page-tabs-content").append(r), e($(".J_menuTab.active"))
        }
        return !1
    };
    aTab = function a(t, lonaId) {
        var n = $(t).attr("href"),
            i = $(t).data("index") === undefined ? $.trim(n).length + 1 : $(t).data("index"),
            r = $.trim($(t).attr("data-tabTitle")),
            s = !0,
            d = false;
        if (void 0 == n || 0 == $.trim(n).length) return !1;
        if ($(parent.document).find(".J_menuTab").each(function (a, i) {
                if ($(i).data("id") == n) {
                    $(i).remove();
                    d = true
                }
                return $(t).data("id") == n ? ($(t).hasClass("active") || ($(t).addClass("active").siblings(".J_menuTab").removeClass("active"), e(t), $(parent.document).find(".J_mainContent .J_iframe").each(function (a, e) {
                    return $(t).data("id") == n ? ($(t).show().siblings(".J_iframe").hide(), !1) : void 0
                })), s = !1, !1) : void 0
            }), s) {
            if (!d) {
                var o = '<a href="javascript:;" class="active J_menuTab" data-loanId="'+ lonaId +'" data-id="' + n + '">' + r + ' <i class="fa fa-times-circle"></i></a>';
                $(parent.document).find(".J_menuTab").removeClass("active");
                var m = '<iframe class="J_iframe" name="iframe' + i + '" width="100%" height="100%" src="' + n + '" frameborder="0" data-id="' + n + '" seamless></iframe>';
                $(parent.document).find(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(m);
                $(parent.document).find(".J_menuTabs .page-tabs-content").append(o), e($(parent.document).find(".J_menuTab.active"));
                var c = layer.load();
                $(parent.document).find(".J_mainContent iframe:visible").load(function () {
                    layer.close(c)
                })
            } else {
                $(parent.document).find(".J_mainContent .J_iframe").each(function (a, t) {
                    if ($(t).data("id") == n) {
                        $(parent.document).find(".J_menuTab").removeClass("active");
                        $(parent.document).find(".J_mainContent iframe:visible").hide();
                        $(t).remove();
                        var s = '<a href="javascript:;" class="active J_menuTab" data-loanId="'+ lonaId +'" data-id="' + n + '">' + r + ' <i class="fa fa-times-circle"></i></a>';
                        var d = '<iframe class="J_iframe" name="iframe' + i + '" width="100%" height="100%" src="' + n + '" frameborder="0" data-id="' + n + '" seamless></iframe>';
                        $(parent.document).find(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(d);
                        $(parent.document).find(".J_menuTabs .page-tabs-content").append(s), e($(parent.document).find(".J_menuTab.active"));
                        var o = layer.load();
                        $(parent.document).find(".J_mainContent iframe:visible").load(function () {
                            layer.close(o)
                        })
                    }
                })
            }
        }
        return !1
    };

    function i() {
        var a = $(this).parents(".J_menuTab").data("id"),
            t = $(this).parents(".J_menuTab").width();
        if ($(this).parents(".J_menuTab").hasClass("active")) {
            if ($(this).parents(".J_menuTab").next(".J_menuTab").size()) {
                var n = $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").data("id");
                $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").addClass("active"), $(".J_mainContent .J_iframe").each(function () {
                    return $(this).data("id") == n ? ($(this).show().siblings(".J_iframe").hide(), !1) : void 0
                });
                var i = parseInt($(".page-tabs-content").css("margin-left"));
                0 > i && $(".page-tabs-content").animate({
                    marginLeft: i + t + "px"
                }, "fast"), $(this).parents(".J_menuTab").remove(), $(".J_mainContent .J_iframe").each(function () {
                    return $(this).data("id") == a ? ($(this).remove(), !1) : void 0
                })
            }
            if ($(this).parents(".J_menuTab").prev(".J_menuTab").size()) {
                var n = $(this).parents(".J_menuTab").prev(".J_menuTab:last").data("id");
                $(this).parents(".J_menuTab").prev(".J_menuTab:last").addClass("active"), $(".J_mainContent .J_iframe").each(function () {
                    return $(this).data("id") == n ? ($(this).show().siblings(".J_iframe").hide(), !1) : void 0
                }), $(this).parents(".J_menuTab").remove(), $(".J_mainContent .J_iframe").each(function () {
                    return $(this).data("id") == a ? ($(this).remove(), !1) : void 0
                })
            }
        } else $(this).parents(".J_menuTab").remove(), $(".J_mainContent .J_iframe").each(function () {
            return $(this).data("id") == a ? ($(this).remove(), !1) : void 0
        }), e($(".J_menuTab.active"));
        return !1
    }

    function r() {
        $(".page-tabs-content").children("[data-id]").not(":first").not(".active").each(function () {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove(), $(this).remove()
        }), $(".page-tabs-content").css("margin-left", "0")
    }

    function s() {
        e($(".J_menuTab.active"))
    }
    var d = {
        "tpl/LetterManage/surveydata.html": "true",
        "tpl/LetterManage/finalSurveydata.html": "true"
    };

    function o() {
        if (!$(this).hasClass("active")) {
            var a = $(this).data("id");
            $(".J_mainContent .J_iframe").each(function () {
                $(this).data("id") === a && d[a] && window.frames[$(this).attr("name")].location.reload();
                return $(this).data("id") == a ? ($(this).show().siblings(".J_iframe").hide(), !1) : void 0
            }), $(this).addClass("active").siblings(".J_menuTab").removeClass("active"), e(this)
        }
    }

    function m() {
        var a = $('.J_iframe[data-id="' + $(this).data("id") + '"]'),
            e = a.attr("src"),
            t = layer.load();
        a.attr("src", e).load(function () {
            layer.close(t)
        })
    }
    $(".J_menuItem").each(function (a) {
        $(this).attr("data-index") || $(this).attr("data-index", a)
    }), $(".J_menuTabs").on("click", ".J_menuTab i", i), $(".J_tabCloseOther").on("click", r), $(".J_tabShowActive").on("click", s), $(".J_menuTabs").on("click", ".J_menuTab", o), $(".J_menuTabs").on("dblclick", ".J_menuTab", m), $(".J_tabLeft").on("click", t), $(".J_tabRight").on("click", n), $(".J_tabCloseAll").on("click", function () {
        $(".page-tabs-content").children("[data-id]").not(":first").each(function () {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove(), $(this).remove()
        }), $(".page-tabs-content").children("[data-id]:first").each(function () {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').show(), $(this).addClass("active")
        }), $(".page-tabs-content").css("margin-left", "0")
    })
});